# Библиотека для сбора и логирования метрик (text-metric-logger)

C++ библиотека для потокобезопасного сбора и записи метрик в реальном времени с минимальным влиянием на производительность.

## Основные возможности

**Гибкость типов данных**  
Поддержка int, float, double и других типов через шаблоны C++

**Различные стратегии агрегации**  
- Сумма (Sum)
- Среднее значение (Avg)
- Максимум (Max)
- Минимум (Min)

**Потокобезопасность**  
- Lock-free добавление значений
- Двойная буферизация при записи

**Простота расширения**  
- Добавление новых метрик без изменения кода библиотеки

## Примеры метрик

- Средняя утилизация CPU за секунду, значения - вещественные числа в диапазоне от 0 до N, где N - количество ядер процессора. Значение 0 - полное отсутсвие загруженности CPU, значение 2 - 100% загрузка двух ядер.
- Количество принятых HTTP запросов за секунду, значения - целые числа от 0 до INT_MAX.
- Средняя температура процессора за секунду, значения - вещественные числа в диапазоне от 35.0 до 100.0 (°C). Значение 35.0 - минимальная рабочая температура, значение 90.0 - критический порог перегрева.
- Общее количество ошибок за секунду, значения - целые числа от 0 до INT_MAX. Значение 0 - отсутствие ошибок, значение больше 0 - количество зарегистрированных ошибок.
- Средний объем используемой памяти за секунду, значения - вещественные числа в диапазоне от 0.0 до X (GB), где X - общий объем установленной RAM. Значение 0.0 - память не используется, значение X - вся память занята.
- Количество операций чтения/записи на диск за секунду, значения - целые числа от 0 до INT_MAX. Значение 0 - отсутствие операций, значение больше 0 - интенсивность дисковых операций.

_Формат вывода: каждая запись метрик - отдельная строка: таймштамп, имена метрик и значения, записанные через пробел._

Пример фрагмента выходного файла:
```txt
2025-06-15 13:40:17.980 "CPU" 1.32995 "HTTP requests RPS" 338 "Temperature" 53.939 "Errors" 9 "Memory Usage" 11.3031 "Disk IO" 1352
2025-06-15 13:40:18.985 "CPU" 1.89452 "HTTP requests RPS" 132 "Temperature" 46.5836 "Errors" 18 "Memory Usage" 7.09106 "Disk IO" 1453
```

## Техническая документация

#### Файл: IMetric.hpp

Общий интерфейс для всех типов метрик.

#### Файл: Metric.hpp

Шаблонный класс для хранения и обработки значений (int, double, и т.д.)

Ключевые методы:

- add(T) — добавление значения
- getValueString() — строковое представление
- reset() — сброс
- Использует std::mutex для защиты

#### Файл: MetricManager.hpp

Отвечает за:
- Регистрацию метрик
- Фоновую запись в файл
- Потокобезопасность

Основные функции:

- ```registerMetric(std::shared_ptr<IMetric>)```
- Интервал записи настраивается в мс

## Добавление новых метрик

Добавить новую метрику (например, "Disk IO" или "Temperature") очень просто.

Пример:
```c++
auto diskIO = std::make_shared<Metric<int>>("Disk IO");
manager.registerMetric(diskIO);
diskIO->add(1234);
```

## Сборка и запуск

#### Сборка через CMake:

```bash
mkdir build
cd build
cmake ..
cmake --build .
cd Debug
./metrics_app
```

Файл с выходными метриками будет находится в папке, где лежит metrics_app.exe (в папке Debug) 

## Требования
- C++17 или новее
- Поддержка многопоточности
- CMake ≥ 3.10
